<script>
// Single header fetch with proper error handling and responsive fixes
(function() {
    'use strict';
    
    function initHeader() {
        const headerDiv = document.getElementById('header');
        if (!headerDiv) return;
        
        // Show loading state
        headerDiv.style.minHeight = '70px';
        headerDiv.style.background = '#f9fafb';
        
        fetch("header.html")
            .then(res => {
                if (!res.ok) throw new Error('Network response was not ok');
                return res.text();
            })
            .then(data => {
                headerDiv.innerHTML = data;
                
                // Wait for DOM update
                setTimeout(() => {
                    fixHeaderAndHeroPosition();
                    initMobileMenu(); // Reinitialize mobile menu after header loads
                }, 50);
            })
            .catch(err => {
                console.error("Header load failed:", err);
                headerDiv.innerHTML = '<div style="background:white; padding:20px; text-align:center">Header failed to load</div>';
            });
    }
    
    // Centralized function for header/hero positioning
    function fixHeaderAndHeroPosition() {
        const header = document.querySelector('header');
        const orangeBanner = document.querySelector('.orange-banner');
        const hero = document.querySelector('.relative.bg-cover.bg-center.h-\\[85vh\\]');
        
        if (!hero || !header) return;
        
        let offset = header.offsetHeight;
        
        // Only add orange banner height on desktop
        if (orangeBanner && window.innerWidth >= 769) {
            offset += orangeBanner.offsetHeight;
        }
        
        hero.style.marginTop = offset + 'px';
    }
    
    // Mobile menu initialization
    function initMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const closeMenuBtn = document.getElementById('closeMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const menuOverlay = document.getElementById('menuOverlay');
        
        if (!mobileMenuBtn || !closeMenuBtn || !mobileMenu || !menuOverlay) {
            return; // Elements not ready yet
        }
        
        // Remove existing listeners
        const newBtn = mobileMenuBtn.cloneNode(true);
        mobileMenuBtn.parentNode.replaceChild(newBtn, mobileMenuBtn);
        
        const newCloseBtn = closeMenuBtn.cloneNode(true);
        closeMenuBtn.parentNode.replaceChild(newCloseBtn, closeMenuBtn);
        
        // Get fresh references
        const btn = document.getElementById('mobileMenuBtn');
        const closeBtn = document.getElementById('closeMenuBtn');
        const menu = document.getElementById('mobileMenu');
        const overlay = document.getElementById('menuOverlay');
        
        function openMenu() {
            menu.classList.add('active');
            overlay.classList.add('active');
            btn.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeMenu() {
            menu.classList.remove('active');
            overlay.classList.remove('active');
            btn.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            openMenu();
        });
        
        closeBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            closeMenu();
        });
        
        overlay.addEventListener('click', closeMenu);
        
        // Close menu on link click
        menu.querySelectorAll('.mobile-menu-item').forEach(link => {
            link.addEventListener('click', closeMenu);
        });
        
        // Close with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && menu.classList.contains('active')) {
                closeMenu();
            }
        });
    }
    
    // Run on load and resize
    window.addEventListener('load', fixHeaderAndHeroPosition);
    window.addEventListener('resize', () => {
        requestAnimationFrame(fixHeaderAndHeroPosition);
    });
    
    // Start header loading
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initHeader);
    } else {
        initHeader();
    }
})();
</script>
